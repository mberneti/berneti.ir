---
title: "داده کاوی - ۶ - ضریب همبستگی پیرسون"
date: "2020-04-19T09:24:53.807Z"
summary: "ضریب همبستگی پیرسون معیاری برای مشخص کردن میزان شباهت"
tags: ["داده کاوی", "پایتون"]
category: "داده کاوی در پایتون"
image: "1398/12/4/0e1890ee-eaea-4d1b-8269-fb786fffafe6.png"
---

<h4>مسئله</h4>
<>
  فرض کنید در مجموعه‌ی داده‌های <strong>ratings_grade_inflation.json</strong> که
  در{" "}
  <a href="https://www.berneti.ir/63/%D8%AF%D8%A7%D8%AF%D9%87-%DA%A9%D8%A7%D9%88%DB%8C-%DB%B3-%D8%AC%D8%B2%D8%A6%DB%8C%D8%A7%D8%AA-%D8%AF%DB%8C%D8%AA%D8%A7%D8%B3%D8%AA-%D9%87%D8%A7">
    #داده کاوی - ۳ - جزئیات دیتاست‌ها
  </a>{" "}
  به شرح جزئیات آن پرداختیم، می‌خواهیم&nbsp;میزان شباهت بین افراد را محاسبه
  کنیم.
</>

| Name    | m1  | m2  | m3  | m4   |
|---------|-----|-----|-----|------|
| Saeed   | 3.0 | 1.0 | 4.0 | 2.00 |
| Abbas   | 2.0 | 3.0 | 3.0 | 4.00 |
| Alireza | 4.5 | 4.0 | 5.0 | 4.25 |

<>
  با اولین نگاه به امتیازات alireza متوجه می‌شود که بازه‌ی امتیازات او در
  محدوده‌ ۴ تا ۵ است (تنوع درجه و یا grade inflation) و اگر بخواهیم صرفا با
  مشاهدات خود میزان شباهت را حدس بزنیم می‌توانیم بگوییم شباهت saeed-alireza
  بیشتر از saeed-abbas است زیرا امتیازاتی که alireza ثبت کرده‌است با امتیازات
  سعید متناسب است، برای مثال کمترین امتیاز alireza که برابر ۴ برای فیلم m2 بوده
  متانسب است با کمترین امتیاز saeed که برای همین فیلم m2 با امتیاز ۱ است ویا
  امتیاز حداکثر علیرضا که ۵ بوده برای فیلم m3 برابر حداکثر امتیاز سعید برای همان
  فیلم با امتیاز ۴ است. درصورتی که تناسب امتیازات saeed و عباس تقریبا برخلاف هم
  است و در نتیجه انتظار داریم شباهت saeed-alireza بیشتر از saeed-abbas باشد.
</>
<>
  حال بگذارید امتیازهای saeed-alireza و saeed-abbas را با استفاده از نمودار
  مقایسه کنیم.
</>
<figure className="image">
  <img src="/img/data-1.png" />
  <figcaption>نمودار مقایسه داده‌ها | ضریب همبستگی پیرسون</figcaption>
</figure>
<>
  همانطور که مشاهده می‌کنید نمودار امتیازات saeed-alireza در راستای یک خط مستقیم
  هست و نمودار امتیازات saeed-abbas بصورت پراکنده است.
  <br />
  نکته مهمی که باقیمیماند این است که صرفا در راستای یک خط راست بودن نشان دهنده‌ی
  تفاهم کامل نیست زیرا اگر این خط بر خلاف نمودار saeed-alireza بصورت نزولی باشد
  نشان دهنده‌ی عدم تفاهم کامل است.
</>
<>
  یکی از راهکارهایی که می‌تواند با توجه به داده‌های ورودی ما و خروجی مدنظر ما را
  تولید کند استفاده از ضریب همبستگی پیرسون است که رفتاری مشابه آنچه که ما
  می‌خواهیم با توجه به نوع پراکندگی نقاط دارد.
</>
<h4>ضریب همبستگی پیرسون یا pearson correlation coefficient</h4>
<>
  ضریب همبستگی پیرسون برای دو متغیر عددی در بازه‌ی ۱ تا ۱- است که ۱ به معنای
  تفاهم کامل و ۱- نشانه‌ی عدم تفاهم کامل است.
  <br />
  در نمودارهای زیر مشاهده می‌کنید که حاصل محاسبه‌ی ضریب همبستگی پیرسون روی
  متغیرهای مختلف چقدر به رفتار مد نظر ما نزدیک است.
</>
<figure className="image">
  <img src="/img/data-2.png" />
  <figcaption>
      www.mathsisfun.com
  </figcaption>
</figure>

<>
  برای مثال ضریب همبستگی داده‌هایی که روی یک خط مستقیم و صعودی قرار گرفته‌اند
  عدد یک به دست آمد که به معنای شباهت کامل برای ما تلقی می‌شد.
</>

<>
  <strong>فرمول ضریب همبستگی پیرسون</strong>
</>

```math
r =
\frac
{\sum_{i=1}^{n}{(x_i-\bar{x})(y_i-\bar{y}})}
{\sqrt{\sum_{i=1}^{n}(x_i-\bar{x})^2}\sqrt{\sum_{i=1}^n(y_i-\bar{y})^2}}
\\\footnotesize{
{\bar{x}=\frac{1}{n}\sum_{i=1}^{n}{x_i}} 
\enspace
*
\enspace 
{\bar{y}=\frac{1}{n}\sum_{i=1}^{n}{y_i}}
}
```

<>
  برای پیاده‌سازی الگوریتم فرمول بالا نیاز هست تا چند بار از روی تمام داده‌ها
  بگذریم و که اسطلاحا به آن multipass می‌گویند.
</>
<>
  <strong>فرمول ضریب همبستگی پیرسون اصلاح شده</strong>
</>
<>
  فرمول زیر تقریبی از فرمول اصلی محاسبه‌ی ضریب همبستگی پیرسون است که مسئله‌ی
  multipass بودن الگوریتم را حل می‌کند و به اصطلاح singlepass است و در نتیجه
  پیچیدگی کمتری دارد و سرعت اجرای آن بالاتر است.
</>

```math
r =
\frac

{
\sum_{i=1}^{n}{x_i y_i}
-\frac{\sum_{i=1}^{n}x_i\sum_{i=1}^{n}y_i}{n}
}

{
\sqrt{
\sum_{i=1}^{n}x_i^2-\frac{{(\sum_{i=1}^{n}x_i)}^2}{n}
}
\sqrt{
\sum_{i=1}^{n}y_i^2-\frac{{(\sum_{i=1}^{n}y_i)}^2}{n}
}
}
```

<h4>پیاده‌سازی ضریب همبستگی پیرسون اصلاح شده در پایتون</h4>
<>
  متد pearson دو لیست از اعداد مرتبط با دو متغیر را گرفته و ضریب همبستگی آنها را
  محاسبه و بر می‌گرداند.
</>

```python
def pearson(rating1, rating2):
    sum_xy = 0
    sum_x = 0
    sum_y = 0
    sum_x2 = 0
    sum_y2 = 0
    n = 0
    for key in rating1:
        if key in rating2:
            n += 1
            x = rating1[key]
            y = rating2[key]
            sum_xy += x * y
            sum_x += x
            sum_y += y
            sum_x2 += pow(x, 2)
            sum_y2 += pow(y, 2)
    
    denominator = sqrt(sum_x2 - pow(sum_x, 2) / n) * sqrt(sum_y2 - pow(sum_y, 2) / n)
    if denominator == 0:
        return 0
    else:
        return (sum_xy - (sum_x * sum_y) / n) / denominator
```

<>
  نتیجه محاسبه ضریب همبستگی پیرسون برای saeed-alireza و saeed-abbas بصورت زیر
  است.
</>

```text
saeed-alireza:0.982708
saeed-abbas:-0.316228
```

<>
  همانطور که پیشبینی می‌کردیم ضریب همبستگی پیرسون که به عنوان معیاری برای میزان
  شباهت در نظر گرفتیم برای saeed-alireza بیشتر از saeed-abbas است.
</>
<>
  حال می‌خواهیم بررسی کنیم آیا با استفاده از فاصله منهتن نیز&nbsp;که در{" "}
  <a href="https://www.berneti.ir/64/%D8%AF%D8%A7%D8%AF%D9%87-%DA%A9%D8%A7%D9%88%DB%8C-%DB%B4-%D9%85%D8%B9%DB%8C%D8%A7%D8%B1-%D9%87%D8%A7%DB%8C-%D9%81%D8%A7%D8%B5%D9%84%D9%87">
    /داده کاوی - ۴ - معیار‌های فاصله
  </a>{" "}
  شرح داده شده به نتایج مورد انتظار می‌رسیم یا خیر.
  <br />
  نکته‌ای که نیاز به یادآوری دارد این است که
  <strong> مفهوم فاصله با شباهت رابطه عکس دارد</strong> و فاصله‌ی کمتر بیانگر شباهت
  بیشتر است و در نتیجه با توجه به موارد گفته شده ما
  <strong> انتظار داریم فاصله‌ی saeed-alireza کمتر از saeed-abbas باشد.</strong>
  <br />
  خروجی زیر نتایج محاسبه‌ی فاصله‌ی منهتن می‌باشد.
</>

```text
saeed-alireza:7.750000
saeed-abbas:6.000000
```

<>
  <strong>اما نتایج بدست آمد برخلاف انتظار ما بدست آمد</strong> و مشکل از
  آنجاییست که که در فاصله‌ی منهتن تنوع در امتیازدهی که اصطلاحا{" "}
  <strong>تنوع درجه و یا grade inflation</strong> در نظر گرفته نمی‌شود و این به
  این معناست تشابه امتیازدهی alireza به saeed با توجه به اینکه او تنها در بازه‌ی
  ۴ تا ۵ امتیازدهی کرده در نظر گرفته نمی‌شود.
</>
<ul>
  <li>
    <a href="https://www.berneti.ir/pearson_correlation_coefficient.html">
      لینک مشاهده‌ی کدها و نتیجه‌ی اجرا
    </a>
  </li>
  <li>
    <a href="https://github.com/mberneti/datamining-python/blob/master/datamining_python/examples/pearson_correlation_coefficient.ipynb">
      لینک کدهای این قسمت در گیت هاب
    </a>
  </li>
</ul>
