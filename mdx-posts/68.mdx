---
title: "داده کاوی - ۵ - شباهت کسینوسی"
date: "2020-04-16T07:51:54.086Z"
summary: "شرح ویژگی‌ها و پیاده‌یازی معیار شباهت کسینوسی در پایتون"
tags: ["داده کاوی", "پایتون"]
category: "داده کاوی در پایتون"
image: "1399/1/4/253055c7-ec77-47f3-81c8-ec68615eea4a.jpg"
---

<h4>معیارهای شباهت</h4>
<>معیارهای شباهت، معیارهایی مانند معیارهای فاصله هستند که میزان دور و یا نزدیک بودن دو موجودیت را مشخص می‌کنند. بدیهی است که معیار شباهت با معیارهای فاصله رابطه عکس دارند و به عبارتی هر چه میزان شباهت بیشتر باشد می‌توان نتیجه گرفت فاصله‌ی دو شیئ کمتر است.</><>در این بخش به شرح چند معیار شباهت و شیوه‌ی پیاده‌سازی آنها در پایتون خواهیم پرداخت.</>

<figure className="image image_resized" style={{"width":"70.65%"}}>
<img src="/img/data-3.jpeg" />
<figcaption><span style={{"backgroundColor":"rgb(245,245,245)","color":"rgb(17,17,17)"}}>Photo by </span>Amir-abbas Abdolali
<span style={{"backgroundColor":"rgb(245,245,245)","color":"rgb(17,17,17)"}}> on </span>Unsplash</figcaption>
</figure>

<h4>شباهت کسینوسی یا Cosine similarity</h4><>شباهت کسینوسی یک معیار شباهت است که پایه آن محاسبه‌ی میزان کسینوس زاویه‌ی بین دو بردار است.</>
<figure className="image image_resized" style={{"width":"100%"}}><img src="/img/data-4.png" /><figcaption>https://www.oreilly.com/library/view/mastering-machine-learning</figcaption></figure>

<>در صورت انطباق دو بردار (در این معیار نشانه شباهت کامل است) که زاویه‌ی بین دو بردار صفر می‌باشد مقدار آن برابر <strong>۱</strong> خواهد شد و در کمترین میزان شباهت دو بردار یعنی اگر زاویه بین دو بردار ۱۸۰ درجه باشد نتیجه این معیار <strong>۱-</strong> خواهد شد.</>

```math
manhattan_distancecos(x,y) = \frac {x \cdot y}{||x|| \cdot ||y||} =
\frac
{\sum_{i=1}^{n}{x_i y_i}}
{\sqrt{\sum_{i=1}^{n}(x_i)^2}\sqrt{\sum_{i=1}^n(y_i)^2}}
```

<>این معیار یکی از پرکاربردترین معیارها در<strong> پردازش متن</strong> است. معیار شباهت کسیونوسی برای استفاده در زمانیکه داده‌های مربوط به ویژگی‌های ما تنک یا <span style={{"color":"rgb(34,34,34)"}}>sparse هستن مناسب است.</span></><h4>داده‌های تنک یا <span style={{"color":"rgb(34,34,34)"}}>sparse</span>
</h4><>برای شرح داده‌های تنک یا اسپارس از یک مثال استفاده می‌کنیم.&nbsp;<br />فرض کنیم می‌خواهیم میزان شباهت دو کتاب انگلیسی را محاسبه کنیم. کلمات یکتای <strong>زبان انگلیسی که حدود یک میلیون واژه</strong> است می‌تواند ویژگی‌های ما باشد و تعداد تکرار هر کلمه در آن کتاب مقادیر آن ویژگی‌ها. آن دو کتاب می‌تواند کتاب&nbsp;'عقل و احساس' با حدود <strong>۷ هزار کلمه</strong> و کتاب 'هری پاتر و سنگ جادو' با حدود <strong>۶ هزار کلمه‌ی</strong> یکتا باشد بدیهی است که حجم بسیار زیادی از ویژگی‌های ما که تعداد کلمات منحصربفرد زبان انگلیسی است خالی مانده و یا به عبارتی مقدار صفر می‌گیرند که در چنین شرایطی می‌گوییم داده‌های ویژگی‌های مسئله <strong>تنک</strong> است.<br />در نقطه مقابل مفهوم تنک اگر تمام ویژگی‌ها یا اکثر آنها دارای مقدار باشند می‌گوییم داده‌های مسئله <strong>غلیظ</strong> است.</><h4>ویژگی‌های شباهت کسینوسی</h4><><strong>۱ـ شباهت کسینوسی به ضرایب مختلف ویژگی‌ها توجه نمی‌کند.</strong><br />برای مثال فرض کنید فردی به فیلم‌های m1 و m2 حداقل امتیاز را با مقدار یک ثبت کرده و دیگری برای آن دو فیلم حداکثر امتیاز را با مقدار ۵ ثبت کرده‌است، در این شرایط شباهت کسینوسی این دو فرد برابر یک می‌شود که نشانه شباهت کامل در این معیار است.</><><strong>۲ـ این معیار مقادیر صفر برای ویژگی‌ها را در نظر نمی‌گیرد.</strong><br />یعنی مناسب زمانیست که صفر به معنای خالی و نامشخص بودن حالت ویژگی در مسئله باشد. مثلا اگر دو مقدار صفر نشان دهنده‌ی ثبت نشدن امتیاز دو فرد برای یک محصول باشد می‌توان از این معیار استفاده نمود، ولی اگر نشان دهنده‌ی امتیاز پایین آن دو شخص باشد که در این حالت می‌توان نتیجه گرفت که نظر این دو فرد مشابه است این معیار به خوبی عمل نمی‌کند زیرا این حالت را در نظر نمی‌گیرد. در چنین شرایطی جابجایی بازه‌ی امتیازات برای مثال بجای ۰ تا ۵ به یک تا ۶ می‌تواند یکی از راه کارهای مفید باشد تا بتوان از این معیار شباهت کسینوسی استفاده نمود.</><h4>شرح مسئله</h4><>فرض کنید می‌خواهیم با استفاده از مجموعه داده‌های ratings_sparseness.json که در <a href="https://www.berneti.ir/63/%D8%AF%D8%A7%D8%AF%D9%87-%DA%A9%D8%A7%D9%88%DB%8C-%DB%B3-%D8%AC%D8%B2%D8%A6%DB%8C%D8%A7%D8%AA-%D8%AF%DB%8C%D8%AA%D8%A7%D8%B3%D8%AA-%D9%87%D8%A7">#داده کاوی - ۳ - جزئیات دیتاست‌ها</a> ساختار آن شرح داده شد میزان تشابه دو فرد را با استفاده از معیار شباهت کسینوسی محاسبه کنیم و جواب‌های بدست آمده را با میزان فاصله آنها با معیار‌ اقلیدوسی که در قسمت <a href="https://www.berneti.ir/64/%D8%AF%D8%A7%D8%AF%D9%87-%DA%A9%D8%A7%D9%88%DB%8C-%DB%B4-%D9%85%D8%B9%DB%8C%D8%A7%D8%B1-%D9%87%D8%A7%DB%8C-%D9%81%D8%A7%D8%B5%D9%84%D9%87">#داده کاوی - ۴ - معیار‌های فاصله</a> به شرح آن پرداختیم مقایسه کنیم.</>

| Name    | m1 | m2 | m3 | m4 | m5 | m6 | m7 | m8 | m9 | m10 |
|---------|----|----|----|----|----|----|----|----|----|-----|
| Saeed   | 4  | 2  | 5  | -  | 2  | 3  | 4  | 5  | -  | -   |
| Abbas   | 3  | -  | 4  | 2  | -  | -  | -  | -  | -  | -   |
| Alireza | 3  | -  | 4  | 5  | 2  | 3  | 4  | 5  | 5  | 5   |

<>با مشاهده‌ی جدول زیر می‌توان به این نتیجه رسید که شباهت saeed و alireza بیشتر تر از شباهت saeed و abbas می‌باشد و اگر بخواهیم از دیدگاه فاصله نگاه کنیم فاصله‌ی بین امتیازات saeed و alireza کمتر از saeed و abbas است.</><>&nbsp;</>

<h4>پیاده‌سازی شباهت کسینوسی در پایتون</h4><>ابتدا تابعی برای محاسبه‌ی ضرب داخلی که ورودی آن دو لیست از اعداد هست را به نام dot بصورت زیر پیاده‌سازی می‌کنیم.
<br />سپس تابع cosine_similarity که لیست امتیازهای دو فرد را گرفته و طبق فرمول ذکر شده شباهت کسینوسی را محاسبه می‌کند را پیاده‌سازی می‌کنیم. در دو خط ابتدایی این تابع ابتدا مقادیر خالی که در اینجا مقدار '-' دارند را از لیست ورودی‌ها و سپس محاسبات را انجام می‌دهیم.&nbsp;</>

```python
def dot(A,B): 
    return (sum(a*b for a,b in zip(A,B)))

def cosine_similarity(rating1,rating2):
    rating1 = dict(filter(lambda x: x[1] != '-', rating1.items()))
    rating2 = dict(filter(lambda x: x[1] != '-', rating2.items()))
    a = rating1.values()
    b = rating2.values()
    return dot(a,b) / ( (dot(a,a) **.5) * (dot(b,b) ** .5) )
```

<>نتیجه بصورت زیر است:</>

```text
saeed-alireza:0.801784
saeed-abbas:0.559893
```

<>همانطور که مشاهده می‌کنید نتایج بدست آماده با نظر ما مطابقت داشته حال بیاید بیبینم که آیا فاصله‌ها که باید بر خلاف میزان شباهت برای saeed و alireza کمتر از saeed و abbas باشد نیز درست بدست می‌آید؟!</><>ما در <a href="https://www.berneti.ir/64/%D8%AF%D8%A7%D8%AF%D9%87-%DA%A9%D8%A7%D9%88%DB%8C-%DB%B4-%D9%85%D8%B9%DB%8C%D8%A7%D8%B1-%D9%87%D8%A7%DB%8C-%D9%81%D8%A7%D8%B5%D9%84%D9%87">داده کاوی - ۴ - معیار‌های فاصله</a>
 به شرح پیاده‌سازی معیارهای فاصله پرداختیم و در اینجا صرفا نتایج استفاده از آن توابع را ذکر می‌کنیم.</>

```text
// manhattan_distance
saeed-alireza:2.000000
saeed-abbas:2.000000

//euclidean_distance
saeed-alireza:1.414214
saeed-abbas:1.414214
```

<>همانطور که مشاهده می‌کنید نتایج بدست آمده از معیارهای فاصله در این مسئله برخلاف نظر ماست زیرا میزان شباهت افراد و امتیازات یکسان هیچ تاثیری بر نتیجه آن نگذاشته‌است و میزان فاصله افراد با هر دو معیار اقلیدوسی و منهتن برای saeed-alireza و saeed-abbas یکسان بدست آمد.</>

<ul>
<li><a href="https://www.berneti.ir/similarity_metrics.html">لینک مشاهده‌ی کدها و نتیجه‌ی اجرا</a></li>
<li><a href="https://github.com/mberneti/datamining-python/blob/master/datamining_python/examples/similarity_metrics.ipynb">لینک کدهای این قسمت در گیت هاب</a></li>
</ul>

<>در آموزش بعدی به شرح <a href="https://www.berneti.ir/69/%D8%AF%D8%A7%D8%AF%D9%87-%DA%A9%D8%A7%D9%88%DB%8C-%DB%B6-%D8%B6%D8%B1%DB%8C%D8%A8-%D9%87%D9%85%D8%A8%D8%B3%D8%AA%DA%AF%DB%8C-%D9%BE%DB%8C%D8%B1%D8%B3%D9%88%D9%86">/داده کاوی - ۶ - ضریب همبستگی پیرسون</a>
 که یکی از معیارهای محاسبه‌ی شباهت است خواهیم پرداخت</>
